---
key: 63c47229a91ce11fa4b745ac9a689484
title: 'Insert title here'
---

## Advanced Apriori Results Filtering

```yaml
type: TitleSlide
key: 2b7d20f97a
```

`@lower_third`
name: Isaiah Hull
title: Economist

`@script`
Filtering Apriori algorithm results by standard metrics won't always yield useful association rules. When this happens, we'll need to apply advanced filtering techniques, making use of multiple metrics, custom metrics, aggregation, and other strategies.

---

## Advanced Filtering

```yaml
type: FullSlide
key: 9d12c26084
```

`@part1`


`@script`
In this video, we'll apply advanced filtering techniques to a set of transactions from a UK-based novelty gift store. 

We'll consider three use cases: 1) using cross-promotion to draw down inventory of a product; and 2) using aggregation and Zhang's metric to select the product layout for a store.

---

## Applying the Apriori Algorithm

```yaml
type: FullSlide
key: a84108ec00
```

`@part1`


`@script`
For both use cases, we'll start with a list of transactions. We'll then one-hot encode the itemsets and apply the Apriori algorithm. Remember that the Apriori algorithm performs pruning by applying the Apriori principle: subsets of frequent itemsets are also frequent.

---

## Applying the Apriori Algorithm

```yaml
type: FullSlide
key: 16488f3f4e
code_zoom: 70
```

`@part1`
```python
import pandas as pd
from mlxtend.preprocessing import TransactionEncoder
from mlxtend.frequent_patterns import apriori
```{{1}}

```python
# Instantiate transaction encoder
encoder = TransactionEncoder()

# One-hot encode itemsets
onehot = encoder.fit(itemsets).transform(itemsets)

# Convert to pandas dataframe
data = pd.DataFrame(onehot, columns = encoder.columns_)
```{{2}}

```python
# Apply Apriori algorithm
frequent_itemsets = apriori(data, min_support=0.01, use_colnames=True)
```{{3}}

`@script`
Let's recall how we can implement this as code. We'll first import pandas under the alias pd, TransactionEncoder from mlxtend dot preprocessing, and apriori from mlxtend dot frequent_patterns. We'll then instantiate an transaction encoder, encode the transactions in one-hot format, and then convert that object to an array.

Finally, we'll apply the Apriori algorithm, yielding the subset of itemsets that are frequent.

---

## Apriori Algorithm Results

```yaml
type: FullSlide
key: 4bbb5015b9
```

`@part1`


`@script`
We now have a list of frequent itemsets and their supports. Notice that Apriori pruned the list from 22,039 itemsets to 2,328. We can now recover the standard set of metrics by applying the association_rules() function we imported earlier.

---

## Identifying Association Rules

```yaml
type: FullSlide
key: d326fa9d86
```

`@part1`


`@script`
This yields 239 rules. Now, let's say we show this list to the store manager and she tells us to cross-promote the the thyme herb marker.

---

## Cross-Promotion

```yaml
type: FullSlide
key: b2eb8be4b0
```

`@part1`


`@script`
We can start by restricting the set of rules to those that have "herb marker thyme" as the consequent. We'll then apply a multi-metric filter that requires the antecedent's support to be greater than 1%, the rule's support to be greater than 0.009, the confidence to be greater than 0.85, and the lift to be greater than 0.82.

Printing the results, we can see that basil, parsley, or rosemary herb markers could be used to cross-promote the thyme herb marker.

---

## Grouping Products

```yaml
type: TwoRowsTwoColumns
key: 46bf2ea683
```

`@part1`


`@part2`


`@part3`


`@part4`


`@script`
Let's look at another quick example of advanced filtering. The store we're advising is re-locating to a new building that is shaped like a horseshoe. The manager is trying to decide how to arrange the sections of the store and wants our input. She offers three options: group boxes and bags together, and signs and candles together. Group boxes and candles, and signs and bags. Or group boxes and signs, and candles and bags.

She tells us that our objective should be to keep disassociated items far apart. We know what this means: we need to use Zhang's metric.

---

## Grouping Products

```yaml
type: FullSlide
key: e362caf79c
```

`@part1`


`@script`
We'll start by performing aggregation, using the function we defined earlier in the chapter. This will identify all of the bags, boxes, candles, and signs in the list of itemsets and will discard everything else. We'll then apply Zhang's rule, which we defined in Chapter 2. Recall that Zhang's rule yields values of between -1 and 1, where -1 captures perfect disassociation and 1 captures perfect association.

---

## Let's practice!

```yaml
type: FinalSlide
key: 6c78e392b4
```

`@script`
